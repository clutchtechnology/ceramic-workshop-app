---
alwaysApply: true
---

# Flutter 工业监控应用模板

> **使用说明**: 复制此模板，修改 `[占位符]` 内容即可快速生成新项目的 AI 提示词。

---

## 1. 项目定义 (必填)

```yaml
项目名称: [ceramic-workshop-app]
应用类型: Windows 桌面工业监控
目标分辨率: [1920×1080] 触摸屏
数据源: [Siemens S7-1200 PLC / REST API / MQTT]
```

---

## 2. 监控设备清单 (按需修改)

| 设备名称 | 数量 | 分区/参数 | 数据块 |
|---------|------|----------|--------|
| [辊道窑] | [1台] | [3段: 温度+能耗] | [DB10] |
| [回转窑] | [3台] | [每台8温区+下料+料仓] | [DB20] |
| [SCR设备] | [2套] | [风机+氨水泵+燃气×2] | [DB30] |

---

## 3. 架构规范

### 目录结构
```
lib/
├── main.dart                 # 入口, 窗口初始化
├── api/                      # HTTP/PLC 通信接口
├── models/                   # 数据模型
├── services/                 # 业务逻辑, 数据采集
├── providers/                # 状态管理 (Provider)
├── pages/                    # 页面
├── widgets/                  # 可复用组件
└── utils/                    # 工具类
```

### 数据流
```
数据源 → api/ → services/ → providers/ → pages/widgets/
              ↓
        MockClient (开发模式)
```

### 核心依赖
```yaml
dependencies:
  flutter_riverpod: ^2.0.0    # 状态管理
  fl_chart: ^0.65.0           # 图表
  window_manager: ^0.3.0      # 窗口控制
  dio: ^5.0.0                 # HTTP (如需)
  # dart_snap7: ^x.x.x        # PLC通信 (如需)
```

---

## 4. UI 设计规范 (工业 HMI 风格)

### 配色 (深色主题)
```dart
// 背景
bgPrimary: #0a0e14, bgSecondary: #111820, bgCard: #1a2332

// 状态 (ISA-101标准)
normal: #00e676 (绿), warning: #ffea00 (黄), alarm: #ff1744 (红), off: #616161 (灰)

// 文字
textPrimary: #e8eaed, textSecondary: #9aa0a6

// 数据曲线
blue: #2196f3, cyan: #00bcd4, orange: #ff9800, purple: #9c27b0
```

### 布局模板 (单页面整合)
```
┌─────────────────────────────────────────────────────┐
│ Header (48px): 标题 | 时间 | 连接状态 | 报警        │
├─────────────────────────┬───────────────────────────┤
│ 左侧实时数据 (60%)      │ 右侧历史图表 (40%)        │
│ - 设备1 卡片组          │ - 时间选择器              │
│ - 设备2 卡片组          │ - 趋势图表                │
│ - 设备N 卡片组          │ - 参数选择                │
├─────────────────────────┴───────────────────────────┤
│ Footer (32px): 连接状态 | 刷新时间 | 版本           │
└──────────────────────────────────────────────────���──┘
```

### 组件规范
| 组件 | 尺寸 | 字体 |
|-----|------|-----|
| KPI卡片 | 160×80px | Roboto Mono, 32-48px |
| 状态指示 | 12-16px圆点 | - |
| 按钮 | 高36-44px | 16px, weight 500 |

---

## 5. 数据采集规范

### 刷新周期
| 数据类型 | 周期 | 说明 |
|---------|------|-----|
| 温度/能耗/流速 | 1秒 | 实时监控 |
| 累计量 | 1秒 | 持续累加 |
| 历史查询 | 按需 | 用户触发 |

### 趋势图表
- 默认窗口: 60秒 (60个数据点)
- 刷新方式: 滚动更新 (FIFO)
- Y轴: 自适应范围

### Mock 数据 (开发模式)
```dart
// 模拟工业数据特性
- 连续性: 基于上一值 ± 小幅波动
- 合理性: 温度 800-1200°C, 电压 380V±10V
- 趋势性: 可模拟升温/降温/稳定阶段
```

---

## 6. 代码模式

### Service 模式
```dart
class DeviceService {
  final String baseUrl;
  DeviceService(this.baseUrl);
  
  Future<DeviceData> fetchData() async {
    // 实现数据获取
  }
}
```

### Provider 模式
```dart
final deviceProvider = StateNotifierProvider<DeviceNotifier, DeviceState>((ref) {
  return DeviceNotifier(ref.read(deviceServiceProvider));
});
```

### 页面模式
```dart
class MonitorPage extends ConsumerStatefulWidget {
  @override
  ConsumerState<MonitorPage> createState() => _MonitorPageState();
}

class _MonitorPageState extends ConsumerState<MonitorPage> {
  Timer? _refreshTimer;
  
  @override
  void initState() {
    super.initState();
    _startAutoRefresh();
  }
  
  void _startAutoRefresh() {
    _refreshTimer = Timer.periodic(Duration(seconds: 1), (_) {
      ref.read(deviceProvider.notifier).refresh();
    });
  }
  
  @override
  void dispose() {
    _refreshTimer?.cancel();
    super.dispose();
  }
}
```

---

## 7. 开发命令

```powershell
flutter run -d windows          # 开发运行
flutter build windows           # 生产构建
```

---

## 8. 常见问题

| 问题 | 解决方案 |
|-----|---------|
| VS 2019 required | Flutter 3.22.x 需要 VS 2019 Build Tools |
| DLL missing | 将依赖 DLL 放入 `build/windows/x64/runner/Debug/` |
| 窗口不全屏 | 检查 `window_manager` 初始化顺序 |

---

## 快速开始新项目

1. **复制此模板**到新项目 `.cursor/rules/app.mdc`
2. **修改第1节**: 项目名称、数据源类型
3. **修改第2节**: 设备清单、参数配置
4. **保留第3-8节**: 通用架构和规范
5. **开始开发**: AI 将按此规范生成代码
